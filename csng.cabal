cabal-version:  3.4
name:           csng
version:        0.0.0
bug-reports:    https://github.com/jonathanknowles/csng/issues
license:        Apache-2.0
license-file:   LICENSE
author:         Jonathan Knowles
maintainer:     mail@jonathanknowles.net
copyright:      2022 Jonathan Knowles
category:       Experimental
synopsis:       Experimental algorithms
description:
    Experimental algorithms.

extra-source-files:
    README.md

flag development
    description: Enable -Werror -O0
    default:     True
    manual:      True

flag release
    description: Enable -Werror -O2
    default:     False
    manual:      True

flag parallel
    description: Enable faster builds
    default:     True
    manual:      True

common common-extensions
    default-extensions:
        ConstraintKinds
        DataKinds
        DefaultSignatures
        DeriveFoldable
        DeriveFunctor
        DerivingStrategies
        DerivingVia
        FlexibleContexts
        FlexibleInstances
        FunctionalDependencies
        GeneralizedNewtypeDeriving
        InstanceSigs
        LambdaCase
        MultiParamTypeClasses
        PatternSynonyms
        ScopedTypeVariables
        StandaloneDeriving
        TupleSections
        TypeApplications
        TypeFamilies
        TypeOperators
        ViewPatterns

common common-options
    ghc-options: -Wall
    if flag(development)
        ghc-options: -Werror -O0
    if flag(release)
        ghc-options: -Werror -O2
    if flag(parallel)
        ghc-options: -j +RTS -A256m -n4m -RTS

common common-prelude
    build-depends:
        csng:prelude
    mixins:
        base hiding (Prelude)
      , csng:prelude (Internal.Prelude as Prelude)
    default-extensions:
        RebindableSyntax
        ImplicitPrelude

source-repository head
    type: git
    location: https://github.com/jonathanknowles/csng

library
    import:
        common-extensions
      , common-options
      , common-prelude
    hs-source-dirs:
        src/public
    exposed-modules:
        Lib
    default-language:
        Haskell2010
    build-depends:
        base >=4.7 && <5
      , csng:internal

library examples
    import:
        common-extensions
      , common-options
      , common-prelude
    hs-source-dirs:
        src/examples
    exposed-modules:
    default-language:
        Haskell2010
    build-depends:
        base >=4.7 && <5
      , csng

library internal
    import:
        common-extensions
      , common-options
      , common-prelude
    hs-source-dirs:
        src/internal
    exposed-modules:
        Algebra.Apportion
        Algebra.Apportion.Balanced
        Algebra.Apportion.Natural
        Algebra.ExactBounded
        Algebra.NewApportion
        Algebra.PartialOrd.Extended
        AsList
        Change
        Data.Foldable.Extended
        Data.Function.Extended
        Data.List.Fraction
        Data.List.NonEmpty.Extended
        Data.Monoid.Monus.Extended
        Value
        Wrapped
    default-language:
        Haskell2010
    build-depends:
        base >=4.7 && <5
      , containers
      , generic-data
      , groups
      , int-cast
      , lattices
      , monoid-subclasses
      , monoidmap
      , QuickCheck
      , quickcheck-classes
      , quickcheck-instances
      , safe
      , semialign
      , semigroupoids
      , strict-containers
      , these

library prelude
    import:
        common-extensions
      , common-options
    hs-source-dirs:
        src/prelude
    exposed-modules:
        Internal.Prelude
    default-language:
        Haskell2010
    build-depends:
        base >=4.7 && <5

test-suite test
    import:
        common-extensions
      , common-options
      , common-prelude
    main-is:
        Spec.hs
    hs-source-dirs:
        src/test
    other-modules:
        Algebra.ApportionSpec
        Algebra.Apportion.BalancedSpec
        ChangeSpec
        Test.Hspec.Unit
        Test.QuickCheck.Classes.Hspec
        Test.QuickCheck.Extended
        Test.QuickCheck.Instances.NonEmpty
        ValueSpec
    type: exitcode-stdio-1.0
    default-language:
        Haskell2010
    build-tool-depends:
        hspec-discover:hspec-discover ==2.*
    build-depends:
        base >=4.7 && <5
      , containers
      , csng
      , csng:internal
      , groups
      , hspec
      , hspec-core
      , pretty-show
      , QuickCheck
      , quickcheck-classes
      , quickcheck-classes-groups
      , quickcheck-classes-monoid-subclasses
      , quickcheck-quid
      , safe
      , strict-containers

benchmark benchmark
    import:
        common-extensions
      , common-options
      , common-prelude
    default-language:
        Haskell2010
    type:
        exitcode-stdio-1.0
    hs-source-dirs:
        src/benchmark
    main-is:
        Main.hs
    build-depends:
        base >=4.7 && <5
      , csng:internal
      , tasty-bench
      , tasty-hunit
